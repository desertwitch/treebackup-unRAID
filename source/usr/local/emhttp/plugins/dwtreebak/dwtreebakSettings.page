Menu="dwtreebakOps:1"
Title="Tree Backup Settings"
Tag="sliders"
Markdown="false"
---
<?
/* Copyright Derek Macias (parts of code from NUT package)
 * Copyright macester (parts of code from NUT package)
 * Copyright gfjardim (parts of code from NUT package)
 * Copyright SimonF (parts of code from NUT package)
 * Copyright Dan Landon (parts of code from Web GUI)
 * Copyright Bergware International (parts of code from Web GUI)
 * Copyright Lime Technology (any and all other parts of Unraid)
 *
 * Copyright desertwitch (as author and maintainer of this file)
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License 2
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 */
require_once '/usr/local/emhttp/plugins/dwtreebak/include/dwtreebak_config.php';
?>

<form markdown="0" id="dwtreebak-settings" name="dwtreebak_settings" method="POST" action="/update.php" target="progressFrame">
    <input type="hidden" id="dwtreebak-set-file" name="#file" value="dwtreebak/dwtreebak.cfg">
    <input type="hidden" id="dwtreebak-set-cmd" name="#command" value="/usr/local/emhttp/plugins/dwtreebak/scripts/write_config">

    <dl>
        <dt>Treeball Location:</dt>
        <dd>
            <strong><?= isset($dwtreebak_binaries) && $dwtreebak_binaries ? $dwtreebak_binaries : "n/a" ?></strong>
        </dd>
    </dl>

    <dl>
        <dt>Treeball Backend:</dt>
        <dd>
            <strong><?= isset($dwtreebak_backend) && $dwtreebak_backend ? $dwtreebak_backend : "n/a" ?></strong>
        </dd>
    </dl>

    <dl>
        <dt><strong>Move on Schedule:</strong></dt>
        <dd>
            <select class="dwtreebak-run" id="CRON" name="CRON" size="1">
                <?=mk_option($dwtreebak_cron, "disable", "Never");?>
                <?=mk_option($dwtreebak_cron, "hourly", "Hourly");?>
                <?=mk_option($dwtreebak_cron, "daily", "Daily");?>
                <?=mk_option($dwtreebak_cron, "weekly", "Weekly");?>
                <?=mk_option($dwtreebak_cron, "monthly", "Monthly");?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    <p>This setting controls how often scheduled tree backups will be generated.</p>
    </blockquote>

    <div id="CRONDOWSETTING">
        <dl>
            <dt>Move on Schedule - Day of Week:</dt>
            <dd>
                <select class="dwtreebak-run" id="CRONDOW" name="CRONDOW" size="1">
                    <?=mk_option($dwtreebak_crondow, "0", "Sunday");?>
                    <?=mk_option($dwtreebak_crondow, "1", "Monday");?>
                    <?=mk_option($dwtreebak_crondow, "2", "Tuesday");?>
                    <?=mk_option($dwtreebak_crondow, "3", "Wednesday");?>
                    <?=mk_option($dwtreebak_crondow, "4", "Thursday");?>
                    <?=mk_option($dwtreebak_crondow, "5", "Friday");?>
                    <?=mk_option($dwtreebak_crondow, "6", "Saturday");?>
                </select>
            </dd>
        </dl>
    </div>

    <div id="CRONDOMSETTING">
        <dl>
            <dt>Move on Schedule - Day of Month:</dt>
            <dd>
                <select class="dwtreebak-run" id="CRONDOM" name="CRONDOM" size="1">
                    <?=dwtreebak_dom_options($dwtreebak_crondom);?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>Beware that not all months of the year have more than 28 days.</p>
        </blockquote>
    </div>

    <div id="CRONHOURSETTING">
        <dl>
            <dt>Move on Schedule - Hour:</dt>
            <dd>
                <select class="dwtreebak-run" id="CRONHOUR" name="CRONHOUR" size="1">
                    <?=dwtreebak_hour_options($dwtreebak_cronhour);?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>It is recommended to pick a time when ideally no other I/O (data transfer) operations are also running.</p>
        </blockquote>
    </div>

    <div id="CRONSETTINGS">
        <dl>
            <dt>Move on Schedule - Started Notifications:</dt>
            <dd>
                <select class="dwtreebak-run" id="STARTNOTIFY" name="STARTNOTIFY" size="1">
                    <?=mk_option($dwtreebak_startnotify, "disable", "No");?>
                    <?=mk_option($dwtreebak_startnotify, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When enabled you will receive notifications when the scheduled moving starts.</p>
        <p>The notifications will be delivered according to Unraid's system-wide notification settings.</p>
        </blockquote>

        <dl>
            <dt>Move on Schedule - Success Notifications:</dt>
            <dd>
                <select class="dwtreebak-run" id="FINISHNOTIFY" name="FINISHNOTIFY" size="1">
                    <?=mk_option($dwtreebak_finishnotify, "disable", "No");?>
                    <?=mk_option($dwtreebak_finishnotify, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When enabled you will receive notifications when the scheduled moving finishes with success.</p>
        <p>The notifications will be delivered according to Unraid's system-wide notification settings.</p>
        </blockquote>

        <dl>
            <dt>Move on Schedule - Failure Notifications:</dt>
            <dd>
                <select class="dwtreebak-run" id="ERRORNOTIFY" name="ERRORNOTIFY" size="1">
                    <?=mk_option($dwtreebak_errornotify, "disable", "No");?>
                    <?=mk_option($dwtreebak_errornotify, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        <p>When enabled you will receive notifications when the scheduled moving encounters any failures (errors).</p>
        <p>This setting can be useful when <strong><em>Success Notifications</em></strong> are disabled and you want to be notified only of scheduled moving failures (errors).</p>
        <p>The notifications will be delivered according to Unraid's system-wide notification settings.</p>
        </blockquote>
    </div>

    <dl>
        <dt>
            <span>
                <input id="RESETCONF" class="dwtreebak-run dwtreebak-tip" type="button" value="Reset Config" title="Reverts the whole configuration to its default state, including the program configuration.">
            </span>
        </dt>
        <dd>
            <span>
                <input type="submit" id="btnApply" name="#apply" value="Apply">
                <input type="button" value="Done" onclick="done()">
                <input id="DEFAULT" type="submit" class="dwtreebak-run dwtreebak-tip" name="#default" value="Default" title="Reverts the displayed settings to their default values, but not the program configuration.">
            </span>
        </dd>
    </dl>
</form>

<script>
function dwtreebakCronSettings() {
    if ($("#CRON").val() === "hourly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").hide();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "daily") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "weekly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").show();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "monthly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").show();
    } else {
        $("#CRONSETTINGS").hide();
        $("#CRONHOURSETTING").hide();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    }
}
function dwtreebakResetConfig() {
    $('#dwtreebak-set-cmd').val('');
    openBox('/plugins/dwtreebak/scripts/resetconf', 'Tree Backup Configuration Reset', 600, 600, true);
}
$(function() {
    showStatus('treeball');

    dwtreebakCronSettings();

    $("#CRON").change(dwtreebakCronSettings);
    $('#RESETCONF').click(function(){ swal({title:"Are you sure?",text:"This action will return any existing configuration to their defaults!",type:"warning",html:true,showCancelButton:true}, dwtreebakResetConfig); });

    $('.dwtreebak-tip').tooltipster({
        maxWidth: 300
    });

    if ( typeof caPluginUpdateCheck === "function" ) {
        caPluginUpdateCheck("dwtreebak.plg",{name:"Tree Backup"});
    }
});
</script>
